<table id="results"
  tal:define="munge_date python:modules['Products.XWFCore.XWFUtils'].munge_date;
  entries options/entries;
  files python:map(lambda e:e['files'] ,entries)"
  tal:condition="python:reduce(lambda a, b: a or b, files, False)">
  <caption>Posts with files</caption>
  <thead>
    <tr>
      <th class="author">From</th>
      <th class="file">File</th>
      <th class="date">Date</th>
    </tr>
  </thead>
  <tbody>
    <tal:block tal:repeat="entry entries">
      <tr tal:condition="python:len(entry['files']) > 0">
        <td class="author">
          <a tal:condition="not:entry/user" 
            tal:attributes="href entry/href" 
            tal:content="structure entry/name">Me!</a>
          <a tal:condition="entry/user" 
            tal:attributes="href entry/href">
            <span class="emailname-self"
              tal:content="structure entry/name">Me!</span></a>
        </td>
        <td class="file" tal:define="files entry/files">
          <tal:block tal:repeat="fm files">
            <a class="file" href="/favicon.ico" 
              type="application/octet-stream"
              tal:define="t fm/mime_type;
                iconName python:t.replace('/','-').replace('.','-').strip()"
              tal:attributes="href entry/href;
                type fm/mime_type;
                class string:fileName ${iconName};
                title fm/file_name;" tal:content="python:fm['file_name'][:50]">&#160;</a>
          </tal:block>
        </td>
        <td tal:define="date python:munge_date(options['context'], entry['date'])"
          class="date">
          <a tal:attributes="href entry/href">
            <span 
              tal:replace="date">
              Today, Tomorrow, Timaru
            </span>
          </a>
        </td>
      </tr>
    </tal:block>
  </tbody>
</table>
