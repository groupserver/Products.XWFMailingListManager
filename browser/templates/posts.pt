<html xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  metal:use-macro="context/@@groupserver_layout/page">
  <head>

    <!--Todo: add the division name.-->
  	<title metal:fill-slot="title">
      Latest posts in
      <span tal:replace="view/groupInfo/name"/>:
      <span tal:replace="view/siteInfo/name"/>
    </title>
    
    <meta name="title" content="Lastest Posts Template"/>
    <meta name="author" content="Michael JasonSmith" />
    <meta name="description" 
      content="This template is used to render the list of latest posts" />
    <meta name="date" content="2006-10-25"/>
    
    <tal:block metal:fill-slot="metadata" 
      tal:define="global postURLPrefix string:p/;
      global topicURLPrefix string:t/;
      global earlierURL view/get_earlier_url;
      global laterURL view/get_later_url;
      global lastChunkURL view/get_last_url">

      <link rel="first" href="posts.html" title="Most recent posts"
        tal:condition="laterURL" />
      <link rel="previous" href="#" title="Later posts"
        tal:condition="laterURL"
        tal:attributes="href laterURL" />
      <link rel="next" href="#" title="Earlier posts"
        tal:condition="earlierURL"
        tal:attributes="href earlierURL" />
      <link rel="last" title="The oldest posts"
        tal:condition="earlierURL"
        tal:attributes="href lastChunkURL" />
      
      <link rel="up" href="#"
        tal:attributes="title view/groupInfo/name;
        href view/groupInfo/url" />
      
      <link rel="alternate" title="ATOM Feed" type="application/atom+xml"
        href="#" 
        tal:attributes="title string:ATOM Feed of the Latest Posts to ${view/groupInfo/name};
        href view/web_feed_uri" />
      
      <!-- The documents related to this post -->
      <link rel="bookmark" title="Group Homepage" href="#"
        tal:attributes="title string:${view/groupInfo/name} Homepage';
        href string:view/groupInfo/url" />
      <link rel="home" 
        tal:attributes="title string:${view/siteInfo/name} Homepage'"
        href="/" />
      <link rel="help" 
        tal:attributes="title string:${view/siteInfo/name} Help"
        href="/help" />
    </tal:block>
  </head>
  
  <body>
    <!--
      - The error-messages can go in odd places, so define them seperately 
      - from the content. In addition, they can be generated by something 
      - other than the "process_form" method of the view. -->
    <div metal:fill-slot="messages"
      tal:define="result view/process_form;
      isError python:result and result.has_key('error') and result['error'];"
      tal:condition="python:result and result.has_key('message')"
      tal:attributes="class python:(isError and 'message-error') or 'message-result'"
      tal:content="structure result/message"/>

    <!-- 
      - The body of the document. Most of the body-content is created 
      - from the messages, grabbed from the XWFVirtualMailingList
      - instance.
    -->
    <tal:block metal:fill-slot="body">
      <h1>Posts in
        <span class="group"
          tal:content="view/groupInfo/name"/></h1>

      <div class="messages-nl" id="postsNavigation"
        tal:define="len view/get_chunk_length">
        <p class="label">Posts Navigation</p>
        <ul>
          <li class="prev">
            <a href="#" tal:condition="laterURL"
              tal:attributes="href laterURL;
              title string:The ${len} more recent posts;">Later 
              <span tal:replace="len">-1</span> posts</a>
            <span tal:condition="not:laterURL">Later
              <span tal:replace="len">-1</span> posts
            </span>
          </li>
          <li class="next">
            <a href="#" tal:condition="earlierURL"
              tal:attributes="href earlierURL;
              title string:The ${len} older posts;">Earlier
              <span tal:replace="len">-1</span> posts</a>
            <span tal:condition="not:earlierURL">Earlier
              <span tal:replace="len">-1</span> posts
            </span>
          </li>
        </ul>
      </div>
      <div class="messages-nl" id="usefulLinks">
        <p class="label">Useful Links</p>
        <ul>
          <li class="topics">
            <a href="topics.html">Topics in
              <tal:block
                content="view/groupInfo/name">This Group</tal:block>
            </a>
          </li>
          <li class="alternateATOM">
            <a title="Web Feed" 
              type="application/atom+xml"
              tal:attributes="title string:Web Feed of the Latest Posts to ${view/groupInfo/name};
              href view/web_feed_uri"
              href="#">Web feed of the latest posts.</a>
          </li>
          <li>
            <a tal:attributes="title string:Summary of posts in ${view/groupInfo/name}"
              href="postsSummary.html?l=60">Summary of Posts</a>
          </li>
        </ul>
      </div>
      
      <tal:block tal:define="postList view/get_posts">
        <div class="postList" 
          tal:condition="python:(len(postList)>0)">
          <tal:block repeat="post postList">
            <p tal:define="position repeat/post/number; 
              topicName post/subject;
              showPhoto python:(position==1) or (postList[position-1]['author_id'] != postList[position-2]['author_id'])"
              tal:replace="structure provider:groupserver.Post">
              The email message is rendered by the Post content provider,
              not by this page.
            </p>
          </tal:block>
        </div><!--postList-->
        <p tal:condition="python:not(len(postList)>0)">
          There are no posts in this group.
        </p>
      </tal:block>
    </tal:block>
  </body>
</html>

