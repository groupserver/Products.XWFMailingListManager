<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  metal:use-macro="context/@@groupserver_layout/page">
  <head>
    
    <!--Todo: add the division name.-->
    <title metal:fill-slot="title">
      Topics in <span tal:replace="python:view.groupInfo.get_name()">a Group</span>:
      <span tal:replace="python:view.siteInfo.get_name()"/>
    </title>
    
    <meta name="title" content="Template for the Topics Summary"/>
    <meta name="author" content="Michael JasonSmith" />
    <meta name="description" 
      content="This template is used to render the summary of topics within a group" />
    <meta name="date" content="2006-11-02"/>
    
    <tal:block metal:fill-slot="metadata" 
      tal:define="global topicURLPrefix string:topic/">
      <!-- The documents related to this post -->
      
      <link rel="previous" title="Later topics" href=""
        tal:define="global laterURL python:view.get_later_url()"
        tal:condition="laterURL"
        tal:attributes="href laterURL;" />
      <link rel="next" title="Earlier topics" href=""
        tal:define="global earlierURL python:view.get_earlier_url()"
        tal:condition="earlierURL"
        tal:attributes="href earlierURL;" />
      <link rel="first" title="Most recent topics" href="topics.html" 
        tal:condition="laterURL" />
      <link rel="last" title="Oldest topics" href="" 
        tal:condition="earlierURL" 
        tal:attributes="href python:view.get_last_url()" />
      
      <link rel="up" title="Group Homepage" href="#"
        tal:attributes="title python:'%s Homepage' % view.groupInfo.get_name();
        href python:view.groupInfo.get_url()" />
      
      <link rel="bookmark" href="posts.html"
        tal:attributes="title python:'Posts in %s' % view.groupInfo.get_name()" />
      <link rel="bookmark" title="Group Homepage" href="#"
        tal:attributes="title python:'%s Homepage' % view.groupInfo.get_name();
        href python:view.groupInfo.get_url()" />
      <link rel="home" 
        tal:attributes="title python:'%s Homepage' % view.siteInfo.get_name();
        href python:view.siteInfo.get_url()" />
      <link rel="help" 
        tal:attributes="title python:'%s Help' % view.siteInfo.get_name();
        href python:'%s/help' % view.siteInfo.get_url()" />
    </tal:block>
    
    <!-- 
      - The standard template used to display a single topic.
      -
      - Like the other message-based templates, the data is martialed
      - out of an XWFVirtualMailingList instance into the page. The
      - template is then passed to the standard GroupServer skin, using
      - the same slots as the GSContent template ("standard.pt").
      -
      -->
    
    <tal:block metal:fill-slot="javascript">
      <!-- Standard GroupServer JavaScript: XForms, Dojo and popup help -->
      <script type="text/javascript" 
        src="/Presentation/Tofu/XForms/js/xforms.js">&#160;</script>
    </tal:block>
    
    <tal:block metal:fill-slot="style">
      <link rel="stylesheet" title="Single-Post Stylesheet" type="text/css" 
        href="/++resource++singlePost.css" />
    </tal:block>
  </head>
  
  <body>
    <!--
      - The error-messages can go in odd places, so define them seperately 
      - from the content. In addition, they can be generated by something 
      - other than the "process_form" method of the view. -->
    <div metal:fill-slot="messages"
      tal:define="result view/process_form;
      isError python:result and result.get('error', False)"
      tal:condition="python:result and result.has_key('message')"
      tal:attributes="class python:(isError and 'message-error') or 'message-result'"
      tal:content="structure result/message"/>
    
    <!-- 
      - The body of the document. Most of the body-content is created 
      - from the messages, grabbed from the XWFVirtualMailingList
      - instance.
      -->
    <tal:block metal:fill-slot="body">
      <form method="post" action="" 
        enctype="application/x-www-form-urlencoded"
        onkeypress="javascript:return keypressEventHandler(this, event)">

        <h1>Topics in 
          <span class="group" 
            tal:content="python:view.groupInfo.get_name()">a Group</span></h1>

        <tal:block 
          tal:define="canPost python:view.get_user_can_post(True)">
          <div class="messages-nl" id="topicsNavigation"
            tal:define="len python:view.get_summary_length()">
            <p class="label">Topics Navigation</p>
            <ul>
              <li class="prev">
                <a href="#" tal:condition="laterURL" 
                  tal:attributes="href laterURL;
                  title string:The ${len} more recent topics;">Later
                  <span tal:replace="len">-1</span> topics</a>
                <span tal:condition="not:laterURL">Later
                  <span tal:replace="len">-1</span> topics
                </span>
              </li>
              <li class="next">
                <a href="#" tal:condition="earlierURL"
                  tal:attributes="href earlierURL;
                  title string:The ${len} older topics;">Earlier
                  <span tal:replace="len">-1</span> topics</a>
                <span tal:condition="not:earlierURL">Earlier
                  <span tal:replace="len">-1</span> topics
                </span>
              </li>
            </ul>
          </div>
          <div class="messages-nl" id="usefulLinks">
            <p class="label">Useful Links</p>
            <ul>
              <li class="posts"><a href="posts.html">Posts in
                  <span tal:replace="python:view.groupInfo.get_name()" />
                </a>
              </li>
              <li class="start" tal:condition="user/getId | nothing">
                <a tal:condition="python:canPost[1]"
                  href="newTopic.html">Start a new topic</a>
              </li>
            </ul>
          </div>

          <p class="cannotPost" tal:condition="python:not canPost[1]">
            You may not start topics, or add to topics, in 
            <span class="group" 
              tal:content="python:view.groupInfo.get_name()">a Group</span>:
            <span tal:replace="python:canPost[0][0].lower()"/>
          </p>
        </tal:block>
        
        <tal:block tal:define="munge_date python:modules['Products.XWFCore.XWFUtils'].munge_date;
          topics python:view.get_topics();
          stickyTopics python:view.get_sticky_topics();
          nonStickyTopics python:view.get_non_sticky_topics()">
          <table id="topicsSummary" 
            tal:condition="python:len(topics)>0">
            <caption>Topics in
              <span class="group" 
                tal:content="python:view.groupInfo.get_name()">a Group</span>
            </caption>
            <thead>
              <tr>
                <th class="topic">Topic</th>
                <th class="posts">Posts</th>
                <th class="date">Latest Post</th>
              </tr>
            </thead>
            <tbody tal:define="lenSticky python:len(stickyTopics)">
              <tal:block tal:condition="stickyTopics">
                <tal:block tal:repeat="stickyTopic stickyTopics">
                  <tr tal:define="position repeat/stickyTopic/number;"
                    tal:attributes="id string:sticky-${stickyTopic/topic_id};
                    class python:((((position) % 2) == 0) and 'evenStickyTopic') or 'oddStickyTopic';">
                    <td class="topic" title="Topic name">
                      <strong>Sticky:</strong>
                      <a href="#"
                      tal:attributes="href string:topic/${stickyTopic/last_post_id}"
                      tal:content="stickyTopic/subject">Wibble</a>
                    </td>
                    <td class="posts" title="Number of posts"
                      tal:content="stickyTopic/count">-1</td>
                    <td class="date" title="Date of the most recent post"
                      tal:define="date python:munge_date(context, stickyTopic['last_post_date'])">
                      <span 
                      tal:replace="date">
                      Today, Tomorrow, Timaru
                      </span>
                    </td>
                  </tr>
                </tal:block>
              </tal:block>
              <tal:block 
                  tal:repeat="topic nonStickyTopics">
                <tr tal:define="position repeat/topic/number;"
                  tal:attributes="id string:topic-${topic/topic_id};
                  class python:((((position + lenSticky) % 2) == 0) and 'even') or 'odd';">
                  <td class="topic" title="Topic name">
                    <a tal:content="python:topic['subject'][:50]"
                      tal:attributes="href string:topic/${topic/last_post_id};
                      title string:The topic ${topic/subject}"
                      href="#">Wibble</a><span 
                      tal:condition="python:len(topic['subject'])&gt;50">&#8230;</span>
                  </td>
                  <td class="posts" title="Number of posts" 
                    tal:content="topic/count">-1</td>
                  <td class="date" title="Date of the most recent post" 
                    tal:define="date python:munge_date(context, topic['last_post_date'])">
                    <span 
                      tal:replace="date">
                      Today, Tomorrow, Timaru
                    </span>
                  </td>
                </tr>
              </tal:block>
            </tbody>
          </table>
          <p tal:condition="python:not(len(topics)>0)">
            There are no topics in this group.
          </p>
        </tal:block>
      </form><!-- The One True XForm-->
    </tal:block>
  </body>
</html>
