<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  metal:use-macro="context/@@groupserver_layout/page">
  <head>

    <!--Todo: add the division name.-->
  	<title metal:fill-slot="title" 
      tal:content="python:view.get_email()['mailSubject']">
      Standard Template for a Single Post
    </title>
    
    <meta name="title" content="Standard Template for a Single Post"/>
    <meta name="author" content="Michael JasonSmith" />
    <meta name="description" 
      content="This template is used to render a single post to GroupServer" />
    <meta name="date" content="2006-10-25"/>
    
    <tal:block metal:fill-slot="metadata" 
      tal:define="global topicName python:view.get_email()['mailSubject'];
      global postURLPrefix string:post.html?id=">
      <!-- The documents related to this post -->
      <link rel="next" 
        tal:define="global next python:view.get_next_email();"
        tal:condition="next"
        tal:attributes="title python:'Next post in &#8220;%s&#8221;' % topicName;
        href python:'%s%s' % (postURLPrefix, next['id']);">&#160;</link>
      <link rel="prev" 
        tal:define="global prev python:view.get_previous_email();"
        tal:condition="prev"
        tal:attributes="title python:'Previous post in &#8220;%s&#8221;' % topicName;
        href python:'%s%s' % (postURLPrefix, prev['id']);">&#160;</link>
      <link rel="first"
        tal:condition="prev"
        tal:define="global first python:view.get_first_email()"
        tal:attributes="title python:'First post in &#8220;%s&#8221;' % topicName;
        href python:'%s%s' % (postURLPrefix, first['id']);">&#160;</link>
      <link rel="last"
        tal:condition="next"
        tal:define="global last python:view.get_last_email()"
        tal:attributes="title python:'Latest post in &#8220;%s&#8221;' % topicName;
        href python:'%s%s' % (postURLPrefix, last['id']);">&#160;</link>
      <tal:block 
        tal:define="title python:'All posts in &#8220;%s&#8221;' % topicName;
        url first">
        <link rel="index" 
          tal:attributes="title title; href url">&#160;</link>
        <link rel="up" 
          tal:attributes="title title; href url">&#160;</link>
      </tal:block>
      
      <link rel="bookmark" title="Group Homepage" href="">&#160;</link>
      <link rel="bookmark" title="Division Homepage" href="/">&#160;</link>
    </tal:block>

    <!-- 
      - The standard template used to display a single post that
      - has been made to a group on GroupServer.
      -
      - Like the other message-based templates, the data is martialed
      - out of an XWFVirtualMailingList instance into the page. The
      - template is then passed to the standard GroupServer skin, using
      - the same slots as the GSContent template ("standard.pt").
      -
      -->
    
    <tal:block metal:fill-slot="javascript">
      <!-- Standard GroupServer JavaScript: XForms, Dojo and popup help -->
      <script type="text/javascript" 
        src="/Presentation/Tofu/XForms/js/xforms.js">&#160;</script>
      <script type="text/javascript"
        src="++resource++dojo/dojo.js">&#160;</script>
      <script type="text/javascript" defer="defer"
        src="++resource++help.js">&#160;</script>
    </tal:block>
    
    <tal:block metal:fill-slot="style">
      <link rel="stylesheet" title="Popup-Help Stylesheet" type="text/css" 
        href="++resource++help.css"/>
    </tal:block>
  </head>
  
  <body>
    <!--
      - The error-messages can go in odd places, so define them seperately 
      - from the content. In addition, they can be generated by something 
      - other than the "process_form" method of the view. -->
    <div metal:fill-slot="messages"
      tal:define="result view/process_form;
      isError python:result and result.has_key('error') and result['error'];"
      tal:condition="python:result and result.has_key('message')"
      tal:attributes="class python:(isError and 'message-error') or 'message-result'"
      tal:content="structure result/message"/>

    <!-- 
      - The body of the document. Most of the body-content is created 
      - from the message, grabbed from the XWFVirtualMailingList
      - instance.
    -->
    <tal:block metal:fill-slot="body">
      <form method="post" action="" 
        enctype="application/x-www-form-urlencoded"
        onkeypress="javascript:return keypressEventHandler(this, event)">
      
        <!-- Site Search -->
        <div id="searcharea">
          <h3>Site Search</h3>
          <input type="text" class="text" name="sitesearch+query"/>
          <input type="submit" name="__submit+sitesearch+search" 
            onclick="submitButtonHandler(this)" value="Go" class="button"/>
        </div>

        <div class="xforms_model">
          <!-- The site-search model -->
          <input type="hidden" name="__submit__" value=""/>
          <input type="hidden" name="__models__" value="sitesearch"/>
          <input type="hidden" name="__instance+sitesearch+query" value=""/>
          <input type="hidden" name="__submission_action+sitesearch+search" 
            value="search_all.xml"/>
          <input type="hidden" name="__submission_method+sitesearch+search"
            value="get"/>
        </div>

        <div id="replacedHelpPane" 
          style="width: 0px; height 0px;">&#160;</div>
        
        <tal:block tal:define="email python:view.get_email()">
          <h1>Post in
            <span tal:content="email/mailSubject">Topic</span></h1>
        
          <div class="xhtml2-nl" id="single-post-topic-navigation">
            <p class="xhtml2-label">Topic Navigation</p>
            <ul>
              <li class="first">
                <a tal:condition="prev"
                  tal:attributes="href string:${postURLPrefix}${first/id};
                  title string:First post in ${email/mailSubject};">First post</a>
                <span tal:condition="not:prev">First post</span>
              </li>
              <li>
                <a tal:condition="prev"
                  tal:attributes="href string:${postURLPrefix}${prev/id};
                  title string:Previous post in ${email/mailSubject};">Previous post</a>
                <span tal:condition="not:prev">Previous post</span>
              </li>
              <li>All posts</li>
              <li>
                <a tal:condition="next"
                  tal:attributes="href string:${postURLPrefix}${next/id};
                  title string:Next post in ${email/mailSubject};">Next post</a>
                <span tal:condition="not:next">Next post</span>
              </li>
              <li>
                <a tal:condition="next"
                  tal:attributes="href string:${postURLPrefix}${last/id};
                  title string:Last post in ${email/mailSubject};">Last post</a>
                <span tal:condition="not:next">Next post</span>                
              </li>
            </ul>
          </div>
          
          <div 
            tal:define="authored python:False and view.user_authored();
            class python:authored and 'emaildetails-self-odd' or 'emaildetails-odd'"
            tal:attributes="class class">
            
            <p class="email-metadata" 
              tal:attributes="id email/id">
              <span class="author">
                <strong>From:</strong>
                <span class="name" tal:content="python:view.context.Scripts.get.user_realnames(email['mailUserId'])">Me!</span>
              </span>
              <span class="posted">
                <strong>Date:</strong>
                <span class="date" 
                  tal:content="email/mailDate">Today, Tomorrow, Timaru</span>
              </span>
              <a class="email-link"
                tal:attributes="href python:'/r/post/%s' % email['id'];"
                title="A short link to this post">Short link</a>
            </p><!--email-metadata-->
            
            <pre class="email-body"
              tal:content="email/mailBody">This should not be seen</pre>
          </div><!--email-details-->
        </tal:block>

      </form><!-- The One True XFrom-->
    </tal:block>
  </body>
</html>
