<tal:block tal:define="post python:options['post'];
  authorId python:options['authorId']; 
  authorName python:options['authorName'];
  authorExists python:options['authorExists'];
  authored python:options['authored'];
  authorImage python:options['authorImage'];
  postIntro options/postIntro;
  postRemainder options/postRemainder;
  timezone python:options['context'].Scripts.get.option('timezone')">
  <div tal:attributes="class options/cssClass; id post/id">
    <p class="email-metadata">
      <span class="topic" tal:condition="options/topicName"
        tal:content="options/topicName">A Topic</span>
      <span class="author">
        <strong>From:</strong>
        <a tal:condition="authorExists" class="name"
          tal:attributes="href string:/contacts/${authorId};
          title string:Profile of ${authorName};"
          tal:content="python:authorName">Me!</a>
        <span tal:condition="not:authorExists" class="name"
          tal:content="python:authorName">Me!</span>
        </span>
      <span class="posted">
        <strong>Date:</strong>
        <span class="date" 
          tal:define="date python:post.mailDate.toZone(timezone).strftime('%F %T')">
          <span 
            tal:replace="date">
            Today, Tomorrow, Timaru
          </span>
          (<span tal:replace="timezone"/>)
        </span>
      </span>
      <a class="email-link"
        tal:attributes="href string:post.html?id=${post/id};"
        title="A short link to this post">Short link</a>
      </p><!--email-metadata-->
    <div tal:condition="authorImage" class="userimage">
      <a tal:attributes="href string:/contacts/${authorId}">
        <img tal:attributes="src authorImage; alt string:Photo of ${authorName}"/>
      </a>
    </div><!--authorImage-->
    <pre class="email-body">
      <p tal:replace="structure options/postIntro">
        This is the body of the document.
      </p>
    </pre><!--email-body-->
    <div class="email-remainder"
      tal:define="remId string:emailRemainder${post/id}; 
      discloseId string:emailDiscloseButton${post/id}">
      <div class="emailshowremainder" 
        tal:condition="options/postRemainder">
        <a href="#" title="Show the email footer"
          tal:define="fn string:showHideInline('${remId}','${discloseId}')"
          tal:attributes="href string:javascript:${fn}; id discloseId;">
          <img alt="&#9654;"
            src="/++resource++postImages/disclosure-arrow-hidden.gif">
        </a>
      </div><!--emailshowremander-->
      <pre class="emailRemainderHidden" 
        tal:condition="options/postRemainder"
        tal:attributes="id remId"
        tal:content="structure options/postRemainder">
        This is the remainder of the email, with such things as the 
        footer.
      </pre><!--emailRemainderHidden-->
    </div><!--email-remainder-->

      <!--I need to fix this -->
    <div class="fileNotification" 
      tal:condition="python:hasattr(post, 'x-xwfnotification-file-id')"
      tal:define="groupObj python:options['context'].Scripts.get.group_object();">
      <div class="fileMetadata"
        tal:repeat="fileId python:post.getProperty('x-xwfnotification-file-id', '').strip().split()">
        <tal:block 
          tal:define="fileObjs python:groupObj.files.find_files({'id': fileId});
          fileObj python:fileObjs and fileObjs[0].getObject() or None"
          tal:condition="fileObj">
          <p>The following file was added to this topic.</p>
          <ul>
            <li 
              tal:define="iconName python:'%s.png'%fileObj.content_type.replace('/','-')">
              Name: 
              <a class="file" href="/favicon.ico" 
                type="application/octet-stream"
                tal:attributes="href string:${options/siteURL}/groups/${options/groupId}/files/f/${fileId}/${fileObj/title_or_id}">
                <img src="/favicon.ico" width="16" height="16" 
                  alt="application/octet-stream" 
                  tal:attributes="alt fileObj/content_type;
                  src python:'/++resource++fileIcons/%s'%iconName"/>
                <span class="filename"
                  tal:content="python:fileObj.title_or_id()">filename</span>
              </a>
            </li>
            <li>Type: 
              <span class="mime"
                tal:content="python:fileObj.content_type">application/octet-stream</span>
            </li>
            <li>
              Size:
              <span class="size"
                tal:content="python:'%1.2fKB' % (fileObj.size/1024.0)">-1B</span>
            </li>
          </ul>
        </tal:block>
      </div><!--fileMetadata-->
    </div><!--fileNotification-->
  </div><!--email-details-->
</tal:block>
